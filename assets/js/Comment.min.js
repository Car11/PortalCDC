class Comment{constructor(id,taskId,userId,username,name,comment,reference,dateCreation,dateModification,hascomments){this.id=id||null,this.taskId=taskId||null,this.userId=userId||null,this.username=username||"",this.name=name||"",this.comment=comment||"",this.reference=reference||"",this.dateCreation=dateCreation||null,this.dateModification=dateModification||null,this.hasComments=hascomments||!1}get LoadbyTask(){$.ajax({type:"POST",url:"class/Comment.php",data:{action:"LoadbyTask",taskId:this.taskId}}).done(function(e){ShowComments(e)}).fail(function(e){showError(e)})}get Load(){$.ajax({type:"POST",url:"class/Comment.php",data:{action:"Load",id:this.id}}).done(function(e){var data=JSON.parse(e)[0]}).fail(function(e){showError(e)})}get Save(){$("#btnSaveComment").attr("disabled","disabled");var miAccion=null==this.id?"Insert":"Update";this.comment=$("#newComment").val(),this.comment=this.comment.replace(/\n/g,"<br>"),this.comment=this.comment.replace(/\r/g,"<br>"),this.comment=this.comment.replace(/\t/g,"<br>"),this.comment=this.comment.replace(/"/g,"'"),$.ajax({type:"POST",url:"class/Comment.php",data:{action:miAccion,obj:JSON.stringify(this)}}).done(function(){ReloadComments()}).fail(function(e){showError(e)}).always(function(){$("#newComment").val(""),setTimeout('$("#btnSaveComment").removeAttr("disabled")',1500),comment=new Comment})}get Delete(){$.ajax({type:"POST",url:"class/Comment.php",data:{action:"Delete",obj:JSON.stringify(this)}}).done(function(){swal({type:"success",title:"Eliminado!",showConfirmButton:!1,timer:1500})}).fail(function(e){showError(e)}).always(function(){comment=new Comment,ReloadComments()})}}let comment=new Comment;function ShowComments(e){$("#commentBox").html("");var data=JSON.parse(e);$.each(data,function(i,item){$("#hascomments").css("display","inline");var avatarLetter=item.name.split(" ");avatarLetter=avatarLetter[0].substring(0,1)+avatarLetter[1].substring(0,1);var modificacion=Date(1e3*item.date_creation);$("#commentBox").append(`\n            <div class="comment" id="comment${item.id}" value= ${item.id} > \n                <div class="avatar avatar-left"> \n                    <div class="avatar-letter" style="background-color: rgb(154, 108, 224)" title="${item.name}">${avatarLetter}</div> \n                </div>\n                <div class="comment-title"> \n                    <strong class="comment-username"> ${item.name} </strong> \n                    <small class="comment-date">Creado en: ${moment(1e3*item.date_creation).format("MMMM Do YYYY, h:mm")}</small>\n                    <small class="comment-date">Actualizado: ${moment(1e3*item.date_modification).fromNow()}</small>\n                </div>\n\n                <div class="comment-actions">\n                    <div class="dropdown">\n                        <a href="#" class="dropdown-menu dropdown-menu-link-icon"><i class="fa fa-cog"></i><i class="glyphicon glyphicon-cog"></i></a>\n                        <ul>\n                            \x3c!-- <li>\n                                <a href="/kanboard/?controller=CommentController&amp;action=edit&amp;task_id=5071&amp;project_id=20&amp;comment_id=83" class="js-modal-medium" title=""><i class="fa fa-edit fa-fw js-modal-medium" aria-hidden="true"></i>Modificar</a>\n                            </li> --\x3e\n                            <li id="delete${item.id}" value="${item.id}" >\n                                <a class="js-modal-confirm" ><i class="glyphicon glyphicon-trash" aria-hidden="true"></i>Suprimir</a>\n                            </li>\n                        </ul>\n                    </div>\n                </div>\n                \n                <div class="comment-content"> <div class="markdown"> <p> ${item.comment} </p> </div>\n            </div>\n        `),$(`#delete${item.id}`).click(function(e){comment.id=$(this).attr("value"),DeleteEventHandler()})})}function DeleteEventHandler(){swal({title:"Eliminar?",text:"Esta acciÃ³n es irreversible!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger"}).then(result=>{result.value&&comment.Delete})}function ReloadComments(){comment.taskId=id,comment.LoadbyTask}$(document).ready(function(){});